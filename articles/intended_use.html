<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Intended Use of chevron • chevron</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Intended Use of chevron">
<meta property="og:description" content="chevron">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">chevron</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<!-- start_releases -->
<li class="dropdown">
	<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
Other releases
<span class="caret"></span></a><ul class="dropdown-menu" role="menu">
   <li><a href="../index.html">latest</a></li>
   <li><a href="..//index.html"></a></li>
</ul></li>
<!-- end_releases -->
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/insightsengineering/chevron">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="intended_use_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Intended Use of chevron</h1>
                        <h4 class="author">Adrian Waddell and Gabriel Becker</h4>
            
            <h4 class="date">2021-12-09</h4>
      
      
      <div class="hidden name"><code>intended_use.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>In this vignette we explain how <code>chevron</code> can be used in a study setting to create many TLGs with relatively little effort. The workflow described in this vignette is a basic one and can be adopted to be more streamlined for a particular setting.</p>
<p>For this vignette we load the following packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/roche/rtables">rtables</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: magrittr</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">chevron</span><span class="op">)</span>
<span class="co">#&gt; Registered S3 method overwritten by 'tern':</span>
<span class="co">#&gt;   method   from </span>
<span class="co">#&gt;   tidy.glm broom</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://cynkra.github.io/dm/">dm</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dm'</span>
<span class="co">#&gt; The following object is masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rlang.r-lib.org">rlang</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'rlang'</span>
<span class="co">#&gt; The following object is masked from 'package:magrittr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     set_names</span></code></pre></div>
</div>
<div id="list-of-planned-outputs-lopo" class="section level2">
<h2 class="hasAnchor">
<a href="#list-of-planned-outputs-lopo" class="anchor"></a>List of Planned Outputs (LoPO)</h2>
<p>A list of planned outputs (LoPO) contains among other information:</p>
<ul>
<li>
<code>tlgfname</code>: function that implements the output</li>
<li>
<code>type</code>: one of <code>graph</code>, <code>listing</code>, <code>table</code>
</li>
<li>
<code>main_title</code>: main title</li>
<li>
<code>subtitles</code>: additional titles</li>
<li>
<code>filters</code>: patient subset definition</li>
<li>
<code>filename</code>: file name where the output should be written to</li>
</ul>
<p>The information above can be stored in various data structures. For this example we assume the information comes from a spreadsheet with one row per output. We will use the following LoPO store in the variable <code>lopo</code> for the remainder of the vignette:</p>
<p>Which provides the following LoPO:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">excerpt</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="kw">function</span><span class="op">(</span><span class="va">xi</span><span class="op">)</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">xi</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">xi</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">1</span>, <span class="fl">8</span><span class="op">)</span>, <span class="st">"..."</span><span class="op">)</span> <span class="kw">else</span> <span class="st">""</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">lopo</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>main_title <span class="op">=</span> <span class="fu">excerpt</span><span class="op">(</span><span class="va">main_title</span><span class="op">)</span>, footnotes <span class="op">=</span> <span class="fu">excerpt</span><span class="op">(</span><span class="va">footnotes</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="8%">
<col width="5%">
<col width="10%">
<col width="9%">
<col width="12%">
<col width="9%">
<col width="12%">
<col width="9%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="left">tlgfname</th>
<th align="left">type</th>
<th align="left">extra_args</th>
<th align="left">output_id</th>
<th align="left">main_title</th>
<th align="left">subtitles</th>
<th align="left">footnotes</th>
<th align="left">filters</th>
<th align="left">filename</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">dmt01_1</td>
<td align="left">table</td>
<td align="left">NULL</td>
<td align="left">t_dm</td>
<td align="left">Demograp …</td>
<td align="left">NULL</td>
<td align="left"></td>
<td align="left">IT</td>
<td align="left">t_dm__IT.txt</td>
</tr>
<tr class="even">
<td align="left">aet02_1</td>
<td align="left">table</td>
<td align="left">NULL</td>
<td align="left">t_ae</td>
<td align="left">Adverse …</td>
<td align="left">NULL</td>
<td align="left">Investig …</td>
<td align="left">FATAL, SE</td>
<td align="left">t_ae__FATAL_SE.txt</td>
</tr>
<tr class="odd">
<td align="left">aet02_1</td>
<td align="left">table</td>
<td align="left">NULL</td>
<td align="left">t_ae</td>
<td align="left">Adverse …</td>
<td align="left">NULL</td>
<td align="left">Investig …</td>
<td align="left">SE</td>
<td align="left">t_ae__SE.txt</td>
</tr>
<tr class="even">
<td align="left">aet02_1</td>
<td align="left">table</td>
<td align="left">NULL</td>
<td align="left">t_ae</td>
<td align="left">Adverse …</td>
<td align="left">NULL</td>
<td align="left">Investig …</td>
<td align="left">SE</td>
<td align="left">t_ae__SE.txt</td>
</tr>
<tr class="odd">
<td align="left">dst01_1</td>
<td align="left">table</td>
<td align="left">NULL</td>
<td align="left">t_ds</td>
<td align="left">Patient …</td>
<td align="left">NULL</td>
<td align="left"></td>
<td align="left">IT</td>
<td align="left">t_ds__IT.txt</td>
</tr>
<tr class="even">
<td align="left">dst01_1</td>
<td align="left">table</td>
<td align="left">NULL</td>
<td align="left">t_ds</td>
<td align="left">Patients …</td>
<td align="left">NULL</td>
<td align="left"></td>
<td align="left">TX, IT</td>
<td align="left">t_ds__TX_IT.txt</td>
</tr>
<tr class="odd">
<td align="left">lbt01_1</td>
<td align="left">table</td>
<td align="left">NULL</td>
<td align="left">l_lb_ctc</td>
<td align="left">Listing …</td>
<td align="left">NULL</td>
<td align="left">Grading …</td>
<td align="left">SE</td>
<td align="left">l_lb_ctc__SE.txt</td>
</tr>
<tr class="even">
<td align="left">lbt01_1</td>
<td align="left">table</td>
<td align="left">NULL</td>
<td align="left">t_lb</td>
<td align="left">Listing …</td>
<td align="left">NULL</td>
<td align="left">Abnormal …</td>
<td align="left">SE</td>
<td align="left">t_lb__SE.txt</td>
</tr>
<tr class="odd">
<td align="left">lbt01_1</td>
<td align="left">table</td>
<td align="left">NULL</td>
<td align="left">l_lb_ls</td>
<td align="left">Listing …</td>
<td align="left">NULL</td>
<td align="left">Includes …</td>
<td align="left">SE</td>
<td align="left">l_lb_ls__SE.txt</td>
</tr>
</tbody>
</table>
<p>Note that the first three columns are not needed for stakeholder interactions and planning/project management. However, the GDS template which is currently encoded in the <code>tlgfname</code> is needed.</p>
</div>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<p>From the <code>lopo</code> above we know that the <em>tlg-functions</em> <code>dmt01_1</code>, <code>aet02_1</code>, <code>dst01_1</code> and <code>lbt01_1</code> are used to create the outputs. <code>chevron</code> knows which datasets are required for the particular TLGs</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">req_data</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dmt01"</span>, <span class="st">"aet02_1"</span>, <span class="st">"dst01_1"</span>, <span class="st">"lbt01_1"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "adsl" "adae" "adlb"</span></code></pre></div>
<p>So the <code>adam_db</code> object needs to contain the following datasets, we will use the <code>scda</code> data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">syn_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/syn_test_data.html">syn_test_data</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"adsl"</span>, <span class="st">"adae"</span>, <span class="st">"adlb"</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt; </span>

<span class="va">adam_study_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://cynkra.github.io/dm/reference/dm.html">dm</a></span><span class="op">(</span>adsl <span class="op">=</span> <span class="va">syn_data</span><span class="op">$</span><span class="va">adsl</span>, adae <span class="op">=</span> <span class="va">syn_data</span><span class="op">$</span><span class="va">adae</span>, adlb <span class="op">=</span> <span class="va">syn_data</span><span class="op">$</span><span class="va">adlb</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://cynkra.github.io/dm/reference/dm_add_pk.html">dm_add_pk</a></span><span class="op">(</span><span class="va">adsl</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>, <span class="st">"STUDYID"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://cynkra.github.io/dm/reference/dm_add_fk.html">dm_add_fk</a></span><span class="op">(</span><span class="va">adae</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>, <span class="st">"STUDYID"</span><span class="op">)</span>, ref_table <span class="op">=</span> <span class="st">"adsl"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://cynkra.github.io/dm/reference/dm_add_pk.html">dm_add_pk</a></span><span class="op">(</span><span class="va">adae</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>, <span class="st">"STUDYID"</span>, <span class="st">"ASTDTM"</span>, <span class="st">"AETERM"</span>, <span class="st">"AESEQ"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://cynkra.github.io/dm/reference/dm_add_fk.html">dm_add_fk</a></span><span class="op">(</span><span class="va">adlb</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>, <span class="st">"STUDYID"</span><span class="op">)</span>, ref_table <span class="op">=</span> <span class="st">"adsl"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://cynkra.github.io/dm/reference/dm_add_pk.html">dm_add_pk</a></span><span class="op">(</span><span class="va">adlb</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"STUDYID"</span>, <span class="st">"USUBJID"</span>, <span class="st">"PARAMCD"</span>, <span class="st">"BASETYPE"</span>, <span class="st">"AVISITN"</span>, <span class="st">"ATPTN"</span>, <span class="st">"DTYPE"</span>, <span class="st">"ADTM"</span>, <span class="st">"LBSEQ"</span>, <span class="st">"ASPID"</span><span class="op">)</span><span class="op">)</span>

<span class="va">adam_study_data</span>
<span class="co">#&gt; ── Metadata ────────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; Tables: `adsl`, `adae`, `adlb`</span>
<span class="co">#&gt; Columns: 186</span>
<span class="co">#&gt; Primary keys: 3</span>
<span class="co">#&gt; Foreign keys: 2</span></code></pre></div>
</div>
<div id="filters" class="section level2">
<h2 class="hasAnchor">
<a href="#filters" class="anchor"></a>Filters</h2>
<p>The <code>lopo</code> contains the following filter labels:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lopo</span><span class="op">$</span><span class="va">filters</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "IT"    "FATAL" "SE"    "TX"</span></code></pre></div>
<p>Each label corresponds to a particular subsetting operation of a dataset. As there is currently no R package available that implements filter label based subsetting on <code>dm</code> objects we provide a basic approach here:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_filter_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dataname</span>, <span class="va">expr</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval-compat.html">enquo</a></span><span class="op">(</span><span class="va">expr</span><span class="op">)</span>
  <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval-compat.html">enquo</a></span><span class="op">(</span><span class="va">dataname</span><span class="op">)</span>
  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://cynkra.github.io/dm/reference/dm.html">is_dm</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
    <span class="fu"><a href="https://cynkra.github.io/dm/reference/dm_filter.html">dm_filter</a></span><span class="op">(</span><span class="va">x</span>, <span class="op">!</span><span class="op">!</span><span class="va">d</span>, <span class="op">!</span><span class="op">!</span><span class="va">e</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="co"># filter label functions</span>
<span class="va">flf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
 ITT <span class="op">=</span> <span class="fu">new_filter_func</span><span class="op">(</span><span class="st">"adsl"</span>, <span class="va">ITTFL</span> <span class="op">==</span> <span class="st">"Y"</span><span class="op">)</span>,
 SE <span class="op">=</span> <span class="fu">new_filter_func</span><span class="op">(</span><span class="st">"adsl"</span>, <span class="va">SAFFL</span> <span class="op">==</span> <span class="st">"Y"</span><span class="op">)</span>,
 CTC35 <span class="op">=</span> <span class="fu">new_filter_func</span><span class="op">(</span><span class="st">"adae"</span>, <span class="va">AETOXGR</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5"</span><span class="op">)</span><span class="op">)</span>,
 FATAL <span class="op">=</span> <span class="fu">new_filter_func</span><span class="op">(</span><span class="st">"adae"</span>, <span class="va">AESDTH</span> <span class="op">==</span> <span class="st">"Y"</span><span class="op">)</span>,
 TX <span class="op">=</span> <span class="va">identity</span>
<span class="op">)</span></code></pre></div>
<p>These filter label based system can then be used as follows, assume we would like the data for <code>CTC35_SE</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">adam__CTC35_SE</span> <span class="op">&lt;-</span> <span class="va">adam_study_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="va">flf</span><span class="op">$</span><span class="fu">SE</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="va">flf</span><span class="op">$</span><span class="fu">CTC35</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://cynkra.github.io/dm/reference/dm_filter.html">dm_apply_filters</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://cynkra.github.io/dm/reference/dm_nrow.html">dm_nrow</a></span><span class="op">(</span><span class="va">adam_study_data</span><span class="op">)</span>
<span class="co">#&gt; adsl adae adlb </span>
<span class="co">#&gt;  400 1934 8400</span>
<span class="fu"><a href="https://cynkra.github.io/dm/reference/dm_nrow.html">dm_nrow</a></span><span class="op">(</span><span class="va">adam__CTC35_SE</span><span class="op">)</span>
<span class="co">#&gt; adsl adae adlb </span>
<span class="co">#&gt;  322  921 6762</span></code></pre></div>
<p>We now introduce the function <code>dm_filter_with_labels</code></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">get_std_filter_label_defn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="va">flf</span>

<span class="va">dm_filter_with_labels</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dm</span>, <span class="va">filter_labels</span>, <span class="va">filter_label_def</span> <span class="op">=</span> <span class="fu">get_std_filter_label_defn</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span>
    <span class="fu"><a href="https://cynkra.github.io/dm/reference/dm.html">is_dm</a></span><span class="op">(</span><span class="va">dm</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">filter_labels</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="va">filter_labels</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">filter_label_def</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>
  
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">filter_labels</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">dm</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Reduce</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">f1</span>, <span class="va">f2</span><span class="op">)</span> <span class="fu">f2</span><span class="op">(</span><span class="va">f1</span><span class="op">)</span>, <span class="va">filter_label_def</span><span class="op">[</span><span class="va">filter_labels</span><span class="op">]</span>, init <span class="op">=</span> <span class="va">dm</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">adam_study_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dm_filter_with_labels</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CTC35"</span>, <span class="st">"SE"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; ── Metadata ────────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; Tables: `adsl`, `adae`, `adlb`</span>
<span class="co">#&gt; Columns: 186</span>
<span class="co">#&gt; Primary keys: 3</span>
<span class="co">#&gt; Foreign keys: 2</span>
<span class="co">#&gt; ── Filters ─────────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; adsl: SAFFL == "Y"</span>
<span class="co">#&gt; adae: AETOXGR %in% c("3", "4", "5")</span></code></pre></div>
<p>so to get the filtered data</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">adam__CTC35_SE</span> <span class="op">&lt;-</span> <span class="va">adam_study_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dm_filter_with_labels</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CTC35"</span>, <span class="st">"SE"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://cynkra.github.io/dm/reference/dm_filter.html">dm_apply_filters</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">adam__CTC35_SE</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://cynkra.github.io/dm/reference/dm_nrow.html">dm_nrow</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; adsl adae adlb </span>
<span class="co">#&gt;  322  921 6762</span></code></pre></div>
</div>
<div id="templating-title-footnotes" class="section level2">
<h2 class="hasAnchor">
<a href="#templating-title-footnotes" class="anchor"></a>Templating Title &amp; Footnotes</h2>
<p>The title and footnotes in the <code>lopo</code> are not ready for the final output. The final titles usually have the form:</p>
<pre><code>{{main_title_lopo}} -- {{population title}}
Protocol: {{protocol}}, Snapshot: {{snapshot}}, Snapshot Date: {{snapshot-date}}, Cutoff Date: {{cutoff-date}}
{{subtitles from lopo}}</code></pre>
<p>We now introduce a simple templating framework based on <code>whiskers</code>. Instead of using the <code>whiskers</code> R package we define our own functionality:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">render_whiskers</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">templates</span>, <span class="va">dict</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">templates</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/character.html">is.character</a></span><span class="op">(</span><span class="va">templates</span><span class="op">)</span>
  <span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="va">templates</span>, <span class="va">render_whiskers_string</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html">character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, dict <span class="op">=</span> <span class="va">dict</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">templates</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">render_whiskers_string</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">template</span>, <span class="va">dict</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/character.html">is.character</a></span><span class="op">(</span><span class="va">template</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">template</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isFALSE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">dict</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isFALSE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">dict</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>

  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">dict</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">template</span><span class="op">)</span>

  <span class="va">ndata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"{{"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">dict</span><span class="op">)</span>, <span class="st">"}}"</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">dict</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">template</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="va">ndata</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">dict</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">template</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">template</span>
<span class="op">}</span></code></pre></div>
<p>The two functions can be used as follows:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">render_whiskers</span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    <span class="st">"{{main_title_lopo}} -- {{population_title}}"</span>,
    <span class="st">"Protocol: {{protocol}}, Snapshot: {{snapshot}}, Snapshot Date: {{snapshot-date}}, Cutoff Date: {{cutoff-date}}"</span>
  <span class="op">)</span>,
  dict <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    main_title_lopo <span class="op">=</span> <span class="st">"Adverse Events"</span>, population_title <span class="op">=</span> <span class="st">"All Patients"</span>,
    protocol <span class="op">=</span> <span class="st">"abc123"</span>, snapshot <span class="op">=</span> <span class="st">"abc123.ib"</span>, <span class="st">"snapshot-date"</span> <span class="op">=</span> <span class="st">"12 March 2020"</span>, <span class="st">"cutoff-date"</span> <span class="op">=</span> <span class="st">"1 February 2020"</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; [1] "Adverse Events -- All Patients"                                                                   </span>
<span class="co">#&gt; [2] "Protocol: abc123, Snapshot: abc123.ib, Snapshot Date: 12 March 2020, Cutoff Date: 1 February 2020"</span></code></pre></div>
</div>
<div id="population-titles" class="section level2">
<h2 class="hasAnchor">
<a href="#population-titles" class="anchor"></a>Population Titles</h2>
<p>Lets make a simple population title creation function</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">population_title</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">filter_labels</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
    <span class="st">"ALL"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">filter_labels</span> <span class="op">~</span> <span class="st">"All Patients"</span>,
    <span class="st">"SE"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">filter_labels</span> <span class="op">~</span> <span class="st">"Safety Evaluable Population"</span>,
    <span class="st">"IT"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">filter_labels</span> <span class="op">~</span> <span class="st">"Intention To Treat Population"</span>,
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"&lt;Population Label not known&gt;"</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="creating-a-standard-output" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-a-standard-output" class="anchor"></a>Creating A Standard Output</h2>
<p>We now use all the concepts for introduced above to create an output. Let’s extracting the data for an output from the lopo:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lopo_1</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/transpose.html">transpose</a></span><span class="op">(</span><span class="va">lopo</span><span class="op">[</span><span class="va">lopo</span><span class="op">$</span><span class="va">tlgfname</span> <span class="op">==</span> <span class="st">"aet02_1"</span>, <span class="op">]</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">lopo_1</span>
<span class="co">#&gt; $tlgfname</span>
<span class="co">#&gt; [1] "aet02_1"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $type</span>
<span class="co">#&gt; [1] "table"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $extra_args</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $output_id</span>
<span class="co">#&gt; [1] "t_ae"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $main_title</span>
<span class="co">#&gt; [1] "Adverse Events Resulting in Death"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $subtitles</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $footnotes</span>
<span class="co">#&gt; [1] "Investigator text for AEs is coded using MedDRA version {{medra-version}}."</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $filters</span>
<span class="co">#&gt; [1] "FATAL" "SE"   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $filename</span>
<span class="co">#&gt; [1] "t_ae__FATAL_SE.txt"</span></code></pre></div>
<p>Now let’s create the output</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Decoration ---</span>
<span class="va">study_dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  protocol <span class="op">=</span> <span class="st">"abc123"</span>,
  snapshot <span class="op">=</span> <span class="st">"abc123.ib"</span>,
  <span class="st">"snapshot-date"</span> <span class="op">=</span> <span class="st">"12 March 2020"</span>,
  <span class="st">"cutoff-date"</span> <span class="op">=</span> <span class="st">"1 February 2020"</span>,
  <span class="st">"medra-version"</span> <span class="op">=</span> <span class="st">"MEDRA v1"</span>
<span class="op">)</span>

<span class="va">null_as_empty_string</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="kw">function</span><span class="op">(</span><span class="va">xi</span><span class="op">)</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">xi</span><span class="op">)</span><span class="op">)</span> <span class="st">""</span> <span class="kw">else</span> <span class="va">xi</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">deco_templ</span> <span class="op">&lt;-</span> <span class="fu">null_as_empty_string</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  title <span class="op">=</span> <span class="st">"{{main_title_lopo}} -- {{population_title}}"</span>,
  subtitles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    <span class="st">"Protocol: {{protocol}}, Snapshot: {{snapshot}}, Snapshot Date: {{snapshot-date}}, Cutoff Date: {{cutoff-date}}"</span>,
    <span class="va">lopo_1</span><span class="op">$</span><span class="va">subtitles</span>
  <span class="op">)</span>,
  main_footer <span class="op">=</span> <span class="va">lopo_1</span><span class="op">$</span><span class="va">footnotes</span>
<span class="op">)</span><span class="op">)</span>

<span class="va">dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="va">study_dict</span>,
  main_title_lopo <span class="op">=</span> <span class="va">lopo_1</span><span class="op">$</span><span class="va">main_title</span>,
  population_title <span class="op">=</span> <span class="fu">population_title</span><span class="op">(</span><span class="va">lopo_1</span><span class="op">$</span><span class="va">filters</span><span class="op">)</span>
<span class="op">)</span>
  
<span class="va">deco</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">deco_templ</span>, <span class="va">render_whiskers</span>, dict <span class="op">=</span> <span class="va">dict</span><span class="op">)</span>

<span class="co">## Data ---</span>
<span class="va">db</span> <span class="op">&lt;-</span> <span class="va">adam_study_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dm_filter_with_labels</span><span class="op">(</span><span class="va">lopo_1</span><span class="op">$</span><span class="va">filters</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/preprocess_data.html">preprocess_data</a></span><span class="op">(</span><span class="va">lopo_1</span><span class="op">$</span><span class="va">tlgfname</span><span class="op">)</span>

<span class="co">## Output ---</span>
<span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">lopo_1</span><span class="op">$</span><span class="va">tlgfname</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>adam_db <span class="op">=</span> <span class="va">db</span>, deco <span class="op">=</span> <span class="va">deco</span><span class="op">)</span>, <span class="va">lopo_1</span><span class="op">$</span><span class="va">extra_args</span><span class="op">)</span><span class="op">)</span>

<span class="va">tbl</span>
<span class="co">#&gt; Adverse Events Resulting in Death -- Safety Evaluable Population</span>
<span class="co">#&gt; Protocol: abc123, Snapshot: abc123.ib, Snapshot Date: 12 March 2020, Cutoff Date: 1 February 2020</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; —————————————————————————————————————————————————————————————————————————————————————————————————————</span>
<span class="co">#&gt; MedDRA System Organ Class                                    A: Drug X    B: Placebo   C: Combination</span>
<span class="co">#&gt;   MedDRA Preferred Term                                        (N=76)       (N=70)         (N=75)    </span>
<span class="co">#&gt; —————————————————————————————————————————————————————————————————————————————————————————————————————</span>
<span class="co">#&gt; Total number of patients with at least one adverse event     76 (100%)    70 (100%)      75 (100%)   </span>
<span class="co">#&gt; Overall total number of events                                  117          111            133      </span>
<span class="co">#&gt; cl D.1                                                                                               </span>
<span class="co">#&gt;   Total number of patients with at least one adverse event   50 (65.8%)    42 (60%)       51 (68%)   </span>
<span class="co">#&gt;   Total number of events                                         61           51             71      </span>
<span class="co">#&gt;   dcd D.1.1.1.1                                              50 (65.8%)    42 (60%)       51 (68%)   </span>
<span class="co">#&gt; cl B.1                                                                                               </span>
<span class="co">#&gt;   Total number of patients with at least one adverse event   47 (61.8%)    49 (70%)      43 (57.3%)  </span>
<span class="co">#&gt;   Total number of events                                         56           60             62      </span>
<span class="co">#&gt;   dcd B.1.1.1.1                                              47 (61.8%)    49 (70%)      43 (57.3%)  </span>
<span class="co">#&gt; —————————————————————————————————————————————————————————————————————————————————————————————————————</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Investigator text for AEs is coded using MedDRA version MEDRA v1.</span></code></pre></div>
<p>This table can now be paginated and saved as a <code>.txt</code> file with <code><a href="https://roche.github.io/rtables/reference/export_as_txt.html">rtables::export_as_txt</a></code>.</p>
</div>
<div id="non-standard-output" class="section level2">
<h2 class="hasAnchor">
<a href="#non-standard-output" class="anchor"></a>Non Standard Output</h2>
<p>Let’s create ad-hoc non-standard output and add it to the lopo and preprocessing map:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ns_dmtspecial</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">adam_db</span>, <span class="va">deco</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">adsl</span> <span class="op">&lt;-</span> <span class="va">adam_db</span><span class="op">$</span><span class="va">adsl</span>
  
  <span class="va">lyt</span> <span class="op">&lt;-</span> <span class="fu">chevron</span><span class="fu">:::</span><span class="fu">basic_table_deco</span><span class="op">(</span><span class="va">deco</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://roche.github.io/rtables/reference/split_cols_by.html">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://roche.github.io/rtables/reference/analyze.html">analyze</a></span><span class="op">(</span><span class="st">"AGE"</span>, <span class="va">mean</span><span class="op">)</span>
  
  <span class="fu"><a href="https://roche.github.io/rtables/reference/build_table.html">build_table</a></span><span class="op">(</span><span class="va">lyt</span>, <span class="va">adsl</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">lopo_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://roche.github.io/rtables/reference/rbind.html">rbind</a></span><span class="op">(</span>
  <span class="va">lopo</span>,
  <span class="fu">lopo_entry</span><span class="op">(</span>
    tlgfname <span class="op">=</span> <span class="st">"ns_dmtspecial"</span>, type <span class="op">=</span> <span class="st">"table"</span>, output_id <span class="op">=</span> <span class="st">"t_aaa"</span>, main_title <span class="op">=</span> <span class="st">"Hello World"</span>,
    subtitles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"this"</span>, <span class="st">"is"</span>, <span class="st">"a test"</span><span class="op">)</span>,
    footnotes <span class="op">=</span> <span class="st">"very important stuff"</span>, filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CTC35"</span>, <span class="st">"SE"</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">pmap_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/append_to_pmap.html">append_to_pmap</a></span><span class="op">(</span><span class="fu"><a href="../reference/std_pmap.html">std_pmap</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="../reference/pmap_row.html">pmap_row</a></span><span class="op">(</span><span class="st">"ns_dmtspecial"</span>, req_data <span class="op">=</span> <span class="st">"adsl"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="modifying-a-standard" class="section level3">
<h3 class="hasAnchor">
<a href="#modifying-a-standard" class="anchor"></a>Modifying a Standard</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ns_aet02_1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aet02_1.html">aet02_1</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>
  
  <span class="fu"><a href="https://roche.github.io/rtables/reference/rbind.html">rbind</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="va">tbl</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">pmap_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/append_to_pmap.html">append_to_pmap</a></span><span class="op">(</span><span class="va">pmap_new</span>, <span class="fu"><a href="../reference/pmap_row.html">pmap_row</a></span><span class="op">(</span><span class="st">"ns_aet02_1"</span>, req_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"adsl"</span>, <span class="st">"adae"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="creating-many-outputs" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-many-outputs" class="anchor"></a>Creating Many Outputs</h2>
<p>We now create functions that create the final outputs:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">std_deco_templ</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lopo_row</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmpl</span> <span class="op">&lt;-</span> <span class="fu">null_as_empty_string</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"{{main_title_lopo}} -- {{population_title}}"</span>,
    subtitles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
      <span class="st">"Protocol: {{protocol}}, Snapshot: {{snapshot}}, Snapshot Date: {{snapshot-date}}, Cutoff Date: {{cutoff-date}}"</span>,
      <span class="va">lopo_row</span><span class="op">$</span><span class="va">subtitles</span>
    <span class="op">)</span>,
    main_footer <span class="op">=</span> <span class="va">lopo_row</span><span class="op">$</span><span class="va">footnotes</span>
  <span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">create_one_tlg</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lopoi</span>, <span class="va">adam_db</span>, <span class="va">pmap</span> <span class="op">=</span> <span class="fu">std_map</span><span class="op">(</span><span class="op">)</span>, <span class="va">deco_template_fun</span> <span class="op">=</span> <span class="va">std_deco_templ</span>,
                           <span class="va">dict</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">character</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">filter_label_def</span> <span class="op">=</span> <span class="fu">get_std_filter_label_defn</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">db</span> <span class="op">&lt;-</span> <span class="va">adam_db</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu">dm_filter_with_labels</span><span class="op">(</span><span class="va">lopoi</span><span class="op">$</span><span class="va">filters</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="../reference/preprocess_data.html">preprocess_data</a></span><span class="op">(</span><span class="va">lopoi</span><span class="op">$</span><span class="va">tlgfname</span>, pmap <span class="op">=</span> <span class="va">pmap</span><span class="op">)</span>
  
  <span class="va">tmpl</span> <span class="op">&lt;-</span> <span class="fu">deco_template_fun</span><span class="op">(</span><span class="va">lopoi</span><span class="op">)</span>
  
  <span class="va">dict_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    <span class="va">study_dict</span>,
    main_title_lopo <span class="op">=</span> <span class="va">lopoi</span><span class="op">$</span><span class="va">main_title</span>,
    population_title <span class="op">=</span> <span class="fu">population_title</span><span class="op">(</span><span class="va">lopoi</span><span class="op">$</span><span class="va">filters</span><span class="op">)</span>
  <span class="op">)</span>
  
  <span class="va">deco</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">tmpl</span>, <span class="va">render_whiskers</span>, dict <span class="op">=</span> <span class="va">dict_i</span><span class="op">)</span>
  
  <span class="co">## Create Output</span>
  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">lopoi</span><span class="op">$</span><span class="va">tlgfname</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>adam_db <span class="op">=</span> <span class="va">db</span>, deco <span class="op">=</span> <span class="va">deco</span><span class="op">)</span>, <span class="va">lopoi</span><span class="op">$</span><span class="va">extra_args</span><span class="op">)</span><span class="op">)</span>
  
<span class="op">}</span>

<span class="va">create_tlg_in_lopo</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">adam_db</span>, <span class="va">lopo</span>, <span class="va">pmap</span> <span class="op">=</span> <span class="fu">std_map</span><span class="op">(</span><span class="op">)</span>, <span class="va">deco_template_fun</span> <span class="op">=</span> <span class="va">std_deco_templ</span>,
                               <span class="va">dict</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">character</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">filter_label_def</span> <span class="op">=</span> <span class="fu">get_std_filter_label_defn</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/transpose.html">transpose</a></span><span class="op">(</span><span class="va">lopo</span><span class="op">)</span>,
                  <span class="va">create_one_tlg</span>, <span class="va">adam_db</span>, pmap <span class="op">=</span> <span class="va">pmap</span>,
                  deco_template_fun <span class="op">=</span> <span class="va">deco_template_fun</span>,
                  dict <span class="op">=</span> <span class="va">dict</span>, filter_label_def <span class="op">=</span> <span class="va">filter_label_def</span><span class="op">)</span>, <span class="va">lopo</span><span class="op">$</span><span class="va">filename</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>And putting it all together</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lopo_sel</span> <span class="op">&lt;-</span> <span class="va">lopo_new</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tlgfname</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"aet02_1"</span>, <span class="st">"ns_dmtspecial"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tbls</span> <span class="op">&lt;-</span> <span class="fu">create_tlg_in_lopo</span><span class="op">(</span>adam_db <span class="op">=</span> <span class="va">adam_study_data</span>, <span class="va">lopo_sel</span>, <span class="va">pmap_new</span>, dict <span class="op">=</span> <span class="va">study_dict</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">tbls</span><span class="op">)</span>
<span class="co">#&gt; [1] "t_ae__FATAL_SE.txt"  "t_ae__SE.txt"        "t_ae__SE.txt"       </span>
<span class="co">#&gt; [4] "t_aaa__CTC35_SE.txt"</span></code></pre></div>
</div>
<div id="summary" class="section level2">
<h2 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h2>
<p>In this vignette we have introduced</p>
<ul>
<li>slightly modified subset of a LoPO</li>
<li>filter labels implementation on top of <code>dm</code>
</li>
<li>title footnotes templating using whisker notation and dictionaries</li>
<li>functions to create the tlgs in the LoPO</li>
<li>working with standard and non-standard TLGs using the preprocessing map <code>pmap</code>
</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by NEST, Roche, Adrian Waddell, Benoit Falquet.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
