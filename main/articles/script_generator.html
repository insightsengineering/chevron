<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="chevron">
<title>Script_Generator â€¢ chevron</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Script_Generator">
<meta property="og:description" content="chevron">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><link rel="stylesheet" href="../consent.css">
<script src="../consent.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">chevron</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1.9056</small>

    <div style="width: 140px; margin-left: 0.5rem;"> <small class="nav-text text-muted me-auto">part of</small> <img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/nest.png?raw=true" alt="NEST" style="height: 30px;"><a href="https://pharmaverse.org/" class="external-link"><img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/pharmaverse.png?raw=true" alt="pharmaverse" style="height: 28px;"></a> </div>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/chevron.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<!-- start dropdown for versions --> <li class="nav-item dropdown">
        <a href="#" class="nav-link dropdown-toggle"
          data-bs-toggle="dropdown" role="button"
          aria-expanded="false" aria-haspopup="true"
          id="dropdown-versions">Versions</a> <div class="dropdown-menu" aria-labelledby="dropdown-versions"> <a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/chevron/main">main</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/chevron/latest-tag">latest-tag</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/chevron/v0.1.2">v0.1.2</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/chevron/v0.1.1">v0.1.1</a> </div></li>
<!-- end dropdown for versions -->
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/insightsengineering/chevron">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Script_Generator</h1>
                        <h4 data-toc-skip class="author">Benoit
Falquet</h4>
            
      
      
      <div class="d-none name"><code>script_generator.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In addition of the embedded <code><a href="../reference/run.html">run()</a></code> method to create a
<code>tlg</code>, chevron offers a script-based approach that allows the
user to quickly edit a chevron workflow without the need for modifying a
<code>chevron_tlg</code> object. The script is generated as two separate
components:</p>
<ul>
<li><p><code>script_args</code> method generates a script for parameters
assignment based on the default value of the arguments but can be edit
either manually after creation or using the <code>dict</code>
argument.</p></li>
<li><p><code>script_funs</code> methods expose by default only the
script corresponding to the pre processing function in the generated
script. However, the main and post processing functions can also be
exposed in the script with the <code>details = TRUE</code>
argument.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="using-a-chevron-defined-object">Using a chevron-defined object<a class="anchor" aria-label="anchor" href="#using-a-chevron-defined-object"></a>
</h2>
<p>The object returned by the <code>script</code> methods are vectors of
character with one element per line of the script, that can be easily
rendered.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/script.html">script_args</a></span><span class="op">(</span><span class="va">aet01_1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Arguments definition ----</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; adam_db &lt;- stop("missing value")</span></span>
<span><span class="co">#&gt; arm_var &lt;- "ACTARM"</span></span>
<span><span class="co">#&gt; deco &lt;- std_deco("AET01")</span></span>
<span><span class="co">#&gt; safety_var &lt;- c("FATAL", "SER", "SERWD", "SERDSM", "RELSER", </span></span>
<span><span class="co">#&gt;     "WD", "DSM", "REL", "RELWD", "RELDSM", "SEV")</span></span>
<span><span class="co">#&gt; req_tables &lt;- c("adsl", "adae")</span></span>
<span><span class="co">#&gt; prune_0 &lt;- FALSE</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/script.html">script_funs</a></span><span class="op">(</span><span class="va">aet01_1</span>, adam_db <span class="op">=</span> <span class="st">"syn_data"</span>, args <span class="op">=</span> <span class="st">"args_list"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Edit Preprocessing Function.</span></span>
<span><span class="co">#&gt; pre_fun &lt;- function (adam_db, req_tables = c("adsl", "adae"), </span></span>
<span><span class="co">#&gt;     arm_var = "ACTARM", safety_var = c("FATAL", "SER", "SERWD", </span></span>
<span><span class="co">#&gt;         "SERDSM", "RELSER", "WD", "DSM", "REL", "RELWD", "RELDSM", </span></span>
<span><span class="co">#&gt;         "SEV"), ...) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     checkmate::assert_class(adam_db, "dm")</span></span>
<span><span class="co">#&gt;     aet01_1_check(adam_db, req_tables = req_tables, arm_var = arm_var, </span></span>
<span><span class="co">#&gt;         safety_var = safety_var)</span></span>
<span><span class="co">#&gt;     db &lt;- adam_db %&gt;% dm_zoom_to("adae") %&gt;% filter(.data$ANL01FL == </span></span>
<span><span class="co">#&gt;         "Y") %&gt;% dm_update_zoomed() %&gt;% dm_zoom_to("adae") %&gt;% </span></span>
<span><span class="co">#&gt;         mutate(FATAL = .data$AESDTH == "Y", SER = .data$AESER == </span></span>
<span><span class="co">#&gt;             "Y", SERWD = (.data$AESER == "Y" &amp; .data$AEACN == </span></span>
<span><span class="co">#&gt;             "DRUG WITHDRAWN"), SERDSM = (.data$AESER == "Y" &amp; </span></span>
<span><span class="co">#&gt;             .data$AEACN %in% c("DRUG INTERRUPTED", "DOSE INCREASED", </span></span>
<span><span class="co">#&gt;                 "DOSE REDUCED")), RELSER = (.data$AESER == "Y" &amp; </span></span>
<span><span class="co">#&gt;             .data$AREL == "Y"), WD = .data$AEACN == "DRUG WITHDRAWN", </span></span>
<span><span class="co">#&gt;             DSM = .data$AEACN %in% c("DRUG INTERRUPTED", "DOSE INCREASED", </span></span>
<span><span class="co">#&gt;                 "DOSE REDUCED"), REL = .data$AREL == "Y", RELWD = (.data$AREL == </span></span>
<span><span class="co">#&gt;                 "Y" &amp; .data$AEACN == "DRUG WITHDRAWN"), RELDSM = (.data$AREL == </span></span>
<span><span class="co">#&gt;                 "Y" &amp; .data$AEACN %in% c("DRUG INTERRUPTED", </span></span>
<span><span class="co">#&gt;                 "DOSE INCREASED", "DOSE REDUCED")), CTC35 = if ("ATOXGR" %in% </span></span>
<span><span class="co">#&gt;                 colnames(.)) </span></span>
<span><span class="co">#&gt;                 .data$ATOXGR %in% c("3", "4", "5"), CTC45 = if ("ATOXGR" %in% </span></span>
<span><span class="co">#&gt;                 colnames(.)) </span></span>
<span><span class="co">#&gt;                 .data$ATOXGR %in% c("4", "5"), SEV = if ("ASEV" %in% </span></span>
<span><span class="co">#&gt;                 colnames(.)) </span></span>
<span><span class="co">#&gt;                 .data$ASEV == "SEVERE", SMQ01 = if ("SMQ01NAM" %in% </span></span>
<span><span class="co">#&gt;                 colnames(.)) </span></span>
<span><span class="co">#&gt;                 .data$SMQ01NAM != "", SMQ02 = if ("SMQ02NAM" %in% </span></span>
<span><span class="co">#&gt;                 colnames(.)) </span></span>
<span><span class="co">#&gt;                 .data$SMQ02NAM != "", CQ01 = if ("CQ01NAM" %in% </span></span>
<span><span class="co">#&gt;                 colnames(.)) </span></span>
<span><span class="co">#&gt;                 .data$CQ01NAM != "") %&gt;% mutate(AEDECOD = formatters::with_label(.data$AEDECOD, </span></span>
<span><span class="co">#&gt;         "Dictionary-Derived Term"), AESDTH = formatters::with_label(.data$AESDTH, </span></span>
<span><span class="co">#&gt;         "Results in Death"), AEACN = formatters::with_label(.data$AEACN, </span></span>
<span><span class="co">#&gt;         "Action Taken with Study Treatment"), FATAL = formatters::with_label(.data$FATAL, </span></span>
<span><span class="co">#&gt;         "AE with fatal outcome"), SER = formatters::with_label(.data$SER, </span></span>
<span><span class="co">#&gt;         "Serious AE"), SEV = if ("SEV" %in% colnames(.)) </span></span>
<span><span class="co">#&gt;         formatters::with_label(.data$SEV, "Severe AE (at greatest intensity)"), </span></span>
<span><span class="co">#&gt;         SERWD = formatters::with_label(.data$SERWD, "Serious AE leading to withdrawal from treatment"), </span></span>
<span><span class="co">#&gt;         SERDSM = formatters::with_label(.data$SERDSM, "Serious AE leading to dose modification/interruption"), </span></span>
<span><span class="co">#&gt;         RELSER = formatters::with_label(.data$RELSER, "Related Serious AE"), </span></span>
<span><span class="co">#&gt;         WD = formatters::with_label(.data$WD, "AE leading to withdrawal from treatment"), </span></span>
<span><span class="co">#&gt;         DSM = formatters::with_label(.data$DSM, "AE leading to dose modification/interruption"), </span></span>
<span><span class="co">#&gt;         REL = formatters::with_label(.data$REL, "Related AE"), </span></span>
<span><span class="co">#&gt;         RELWD = formatters::with_label(.data$RELWD, "Related AE leading to withdrawal from treatment"), </span></span>
<span><span class="co">#&gt;         RELDSM = formatters::with_label(.data$RELDSM, "Related AE leading to dose modification/interruption"), </span></span>
<span><span class="co">#&gt;         CTC35 = if ("CTC35" %in% colnames(.)) </span></span>
<span><span class="co">#&gt;             formatters::with_label(.data$CTC35, "Grade 3-5 AE"), </span></span>
<span><span class="co">#&gt;         CTC45 = if ("CTC45" %in% colnames(.)) </span></span>
<span><span class="co">#&gt;             formatters::with_label(.data$CTC45, "Grade 4/5 AE")) %&gt;% </span></span>
<span><span class="co">#&gt;         dm_update_zoomed()</span></span>
<span><span class="co">#&gt;     missing_rule &lt;- rule(`&lt;Missing&gt;` = c("", NA))</span></span>
<span><span class="co">#&gt;     new_format &lt;- list(adsl = list(DCSREAS = missing_rule))</span></span>
<span><span class="co">#&gt;     db &lt;- dunlin::reformat(db, new_format, na_last = TRUE)</span></span>
<span><span class="co">#&gt;     db</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Create TLG.</span></span>
<span><span class="co">#&gt; tlg_output &lt;- rlang::exec(.fn = pre_fun, adam_db = syn_data, !!!args_list) |&gt;</span></span>
<span><span class="co">#&gt; rlang::exec(.fn = run, object = aet01_1, !!!args_list, auto_pre = FALSE, check_arg = FALSE)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="with-a-modified-chevron-object">With a modified chevron object<a class="anchor" aria-label="anchor" href="#with-a-modified-chevron-object"></a>
</h2>
<p>The script generator depends on the functions actually stored in the
object. Modifying the <code>chevron_tlg</code> object can lead to a
different script.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/preprocess.html">preprocess</a></span><span class="op">(</span><span class="va">aet01_1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">adam_db</span>, <span class="va">new_format</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">dunlin</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dunlin/man/reformat.html" class="external-link">reformat</a></span><span class="op">(</span><span class="va">adam_db</span>, <span class="va">new_format</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">res_args</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/script.html">script_args</a></span><span class="op">(</span><span class="va">aet01_1</span><span class="op">)</span></span>
<span><span class="va">res_funs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/script.html">script_funs</a></span><span class="op">(</span><span class="va">aet01_1</span>, adam_db <span class="op">=</span> <span class="st">"syn_data"</span>, args <span class="op">=</span> <span class="st">"args_list"</span><span class="op">)</span></span></code></pre></div>
<p>Print the generated scripts. Note that a new argument
<code>new_format</code> has been added and the pre processing function
has been modified.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">res_args</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Arguments definition ----</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; adam_db &lt;- stop("missing value")</span></span>
<span><span class="co">#&gt; arm_var &lt;- "ACTARM"</span></span>
<span><span class="co">#&gt; deco &lt;- std_deco("AET01")</span></span>
<span><span class="co">#&gt; safety_var &lt;- c("FATAL", "SER", "SERWD", "SERDSM", "RELSER", </span></span>
<span><span class="co">#&gt;     "WD", "DSM", "REL", "RELWD", "RELDSM", "SEV")</span></span>
<span><span class="co">#&gt; new_format &lt;- stop("missing value")</span></span>
<span><span class="co">#&gt; prune_0 &lt;- FALSE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">res_funs</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Edit Preprocessing Function.</span></span>
<span><span class="co">#&gt; pre_fun &lt;- function(adam_db, new_format, ...) {</span></span>
<span><span class="co">#&gt;   dunlin::reformat(adam_db, new_format)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Create TLG.</span></span>
<span><span class="co">#&gt; tlg_output &lt;- rlang::exec(.fn = pre_fun, adam_db = syn_data, !!!args_list) |&gt;</span></span>
<span><span class="co">#&gt; rlang::exec(.fn = run, object = aet01_1, !!!args_list, auto_pre = FALSE, check_arg = FALSE)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="with-custom-argument-definition">With custom argument definition<a class="anchor" aria-label="anchor" href="#with-custom-argument-definition"></a>
</h2>
<p>To define the value of an argument in the directly in the
<code>script_args</code> method, pass it to a named list. Existing
values will be overwritten.</p>
<p>Note: variables (in this case the <code>dm</code> object
<code>syn_data</code>), have to be passed as symbol, using for instance
<code><a href="https://rlang.r-lib.org/reference/sym.html" class="external-link">rlang::sym</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  adam_db <span class="op">=</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/sym.html" class="external-link">sym</a></span><span class="op">(</span><span class="st">"syn_data"</span><span class="op">)</span>,</span>
<span>  some_character <span class="op">=</span> <span class="st">"A"</span>,</span>
<span>  some_vector <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">res_args</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/script.html">script_args</a></span><span class="op">(</span><span class="va">mng01_1</span>, dict <span class="op">=</span> <span class="va">dict</span><span class="op">)</span></span>
<span><span class="va">res_funs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/script.html">script_funs</a></span><span class="op">(</span><span class="va">mng01_1</span>, adam_db <span class="op">=</span> <span class="st">"syn_data"</span>, args <span class="op">=</span> <span class="st">"args_list"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">res_args</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Arguments definition ----</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; adam_db &lt;- syn_data</span></span>
<span><span class="co">#&gt; some_character &lt;- "A"</span></span>
<span><span class="co">#&gt; some_vector &lt;- c("A", "B")</span></span>
<span><span class="co">#&gt; dataset &lt;- "adlb"</span></span>
<span><span class="co">#&gt; x_var &lt;- "AVISIT"</span></span>
<span><span class="co">#&gt; y_var &lt;- "AVAL"</span></span>
<span><span class="co">#&gt; y_name &lt;- "PARAM"</span></span>
<span><span class="co">#&gt; y_unit &lt;- NA</span></span>
<span><span class="co">#&gt; arm_var &lt;- "ACTARM"</span></span>
<span><span class="co">#&gt; center_fun &lt;- c("mean", "median")</span></span>
<span><span class="co">#&gt; interval_fun &lt;- c("mean_ci", "mean_sei", "mean_sdi", "median_ci", </span></span>
<span><span class="co">#&gt;     "quantiles", "range")</span></span>
<span><span class="co">#&gt; show_table &lt;- TRUE</span></span>
<span><span class="co">#&gt; jitter &lt;- TRUE</span></span>
<span><span class="co">#&gt; show_n &lt;- TRUE</span></span>
<span><span class="co">#&gt; show_h_grid &lt;- TRUE</span></span>
<span><span class="co">#&gt; show_v_grid &lt;- FALSE</span></span>
<span><span class="co">#&gt; legend_pos &lt;- "top"</span></span>
<span><span class="co">#&gt; line_col &lt;- nestcolor::color_palette()</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">res_funs</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Edit Preprocessing Function.</span></span>
<span><span class="co">#&gt; pre_fun &lt;- function (adam_db, dataset, x_var = "AVISIT", ...) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     checkmate::assert_class(adam_db, "dm")</span></span>
<span><span class="co">#&gt;     adam_db &lt;- adam_db %&gt;% dm_zoom_to(!!dataset) %&gt;% filter(.data$ANL01FL == </span></span>
<span><span class="co">#&gt;         "Y") %&gt;% dm_update_zoomed()</span></span>
<span><span class="co">#&gt;     dunlin::dm_unite(adam_db, dataset, x_var, "_")</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Create TLG.</span></span>
<span><span class="co">#&gt; tlg_output &lt;- rlang::exec(.fn = pre_fun, adam_db = syn_data, !!!args_list) |&gt;</span></span>
<span><span class="co">#&gt; rlang::exec(.fn = run, object = mng01_1, !!!args_list, auto_pre = FALSE, check_arg = FALSE)</span></span></code></pre></div>
<p>If saved in a <code>.R</code> file, the generated script can be
executed. The result stored in <code>tlg_output</code> can be
printed.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp_args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"my_script_args"</span>, fileext <span class="op">=</span> <span class="st">"R"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">res_args</span>, con <span class="op">=</span> <span class="va">tmp_args</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp_funs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"my_script_funs"</span>, fileext <span class="op">=</span> <span class="st">"R"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">res_funs</span>, con <span class="op">=</span> <span class="va">tmp_funs</span><span class="op">)</span></span>
<span></span>
<span><span class="va">args_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  dataset <span class="op">=</span> <span class="st">"adlb"</span>,</span>
<span>  arm_var <span class="op">=</span> <span class="st">"ARM"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"syn_data"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="va">tmp_args</span>, local <span class="op">=</span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit_global.html" class="external-link">knit_global</a></span><span class="op">(</span><span class="op">)</span>, echo <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; adam_db &lt;- syn_data</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; some_character &lt;- "A"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; some_vector &lt;- c("A", "B")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; dataset &lt;- "adlb"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; x_var &lt;- "AVISIT"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; y_var &lt;- "AVAL"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; y_name &lt;- "PARAM"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; y_unit &lt;- NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; arm_var &lt;- "ACTARM"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; center_fun &lt;- c("mean", "median")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; interval_fun &lt;- c("mean_ci", "mean_sei", "mean_sdi", </span></span>
<span><span class="co">#&gt; +     "median_ci", "quantiles", "range")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; show_table &lt;- TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; jitter &lt;- TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; show_n &lt;- TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; show_h_grid &lt;- TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; show_v_grid &lt;- FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; legend_pos &lt;- "top"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; line_col &lt;- nestcolor::color_palette()</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="va">tmp_funs</span>, local <span class="op">=</span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit_global.html" class="external-link">knit_global</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tlg_output</span></span>
<span><span class="co">#&gt; $`Alanine Aminotransferase Measurement`</span></span></code></pre></div>
<p><img src="script_generator_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`C-Reactive Protein Measurement`</span></span></code></pre>
<p><img src="script_generator_files/figure-html/unnamed-chunk-7-2.png" width="672"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Immunoglobulin A Measurement`</span></span></code></pre>
<p><img src="script_generator_files/figure-html/unnamed-chunk-7-3.png" width="672"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "gg_list" "list"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="exploring-main-and-post-process-functions">Exploring Main and Post process functions<a class="anchor" aria-label="anchor" href="#exploring-main-and-post-process-functions"></a>
</h2>
<p>By specifying <code>details = TRUE</code> the main and post
processing functions are also exposed.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_fun</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/script.html">script_funs</a></span><span class="op">(</span><span class="va">mng01_1</span>, adam_db <span class="op">=</span> <span class="st">"syn_data"</span>, args <span class="op">=</span> <span class="st">"args_list"</span>, details <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">res_fun</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Edit Functions.</span></span>
<span><span class="co">#&gt; pre_fun &lt;- function (adam_db, dataset, x_var = "AVISIT", ...) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     checkmate::assert_class(adam_db, "dm")</span></span>
<span><span class="co">#&gt;     adam_db &lt;- adam_db %&gt;% dm_zoom_to(!!dataset) %&gt;% filter(.data$ANL01FL == </span></span>
<span><span class="co">#&gt;         "Y") %&gt;% dm_update_zoomed()</span></span>
<span><span class="co">#&gt;     dunlin::dm_unite(adam_db, dataset, x_var, "_")</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; main_fun &lt;- function (adam_db, dataset = "adlb", x_var = "AVISIT", </span></span>
<span><span class="co">#&gt;     y_var = "AVAL", y_name = "PARAM", y_unit = NA, arm_var = "ACTARM", </span></span>
<span><span class="co">#&gt;     center_fun = c("mean", "median"), interval_fun = c("mean_ci", </span></span>
<span><span class="co">#&gt;         "mean_sei", "mean_sdi", "median_ci", "quantiles", "range"), </span></span>
<span><span class="co">#&gt;     show_table = TRUE, jitter = TRUE, show_n = TRUE, show_h_grid = TRUE, </span></span>
<span><span class="co">#&gt;     show_v_grid = FALSE, legend_pos = "top", line_col = nestcolor::color_palette(), </span></span>
<span><span class="co">#&gt;     ...) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     df &lt;- adam_db[[dataset]]</span></span>
<span><span class="co">#&gt;     data_ls &lt;- split(df, df$PARAM, drop = TRUE)</span></span>
<span><span class="co">#&gt;     x_var &lt;- paste(x_var, collapse = "_")</span></span>
<span><span class="co">#&gt;     center_fun &lt;- match.arg(center_fun)</span></span>
<span><span class="co">#&gt;     interval_fun &lt;- match.arg(interval_fun)</span></span>
<span><span class="co">#&gt;     checkmate::assert_flag(show_table)</span></span>
<span><span class="co">#&gt;     checkmate::assert_flag(jitter)</span></span>
<span><span class="co">#&gt;     checkmate::assert_flag(show_n)</span></span>
<span><span class="co">#&gt;     checkmate::assert_flag(show_h_grid)</span></span>
<span><span class="co">#&gt;     checkmate::assert_flag(show_v_grid)</span></span>
<span><span class="co">#&gt;     checkmate::assert_character(line_col, null.ok = TRUE)</span></span>
<span><span class="co">#&gt;     interval_title &lt;- switch(interval_fun, mean_ci = "95% Confidence Intervals", </span></span>
<span><span class="co">#&gt;         mean_sei = "Standard Error", mean_sdi = "Standard Deviation", </span></span>
<span><span class="co">#&gt;         median_ci = "95% Confidence Intervals", quantiles = "Interquatile Range", </span></span>
<span><span class="co">#&gt;         range = "Min-Max Range")</span></span>
<span><span class="co">#&gt;     title &lt;- paste0("Plot of ", center_fun, " and ", interval_title, </span></span>
<span><span class="co">#&gt;         " by ", var_labels_for(df, x_var))</span></span>
<span><span class="co">#&gt;     whiskers_fun &lt;- switch(interval_fun, mean_ci = c("mean_ci_lwr", </span></span>
<span><span class="co">#&gt;         "mean_ci_upr"), mean_sei = c("mean_sei_lwr", "mean_sei_upr"), </span></span>
<span><span class="co">#&gt;         mean_sdi = c("mean_sdi_lwr", "mean_sdi_upr"), median_ci = c("median_ci_lwr", </span></span>
<span><span class="co">#&gt;             "median_ci_upr"), quantiles = c("quantiles_0.25", </span></span>
<span><span class="co">#&gt;             "quantile_0.75"), range = c("min", "max"))</span></span>
<span><span class="co">#&gt;     variables &lt;- c(x = x_var, y = y_var, strata = arm_var, paramcd = y_name, </span></span>
<span><span class="co">#&gt;         y_unit = y_unit)</span></span>
<span><span class="co">#&gt;     n_func &lt;- if (show_n) </span></span>
<span><span class="co">#&gt;         "n"</span></span>
<span><span class="co">#&gt;     else NULL</span></span>
<span><span class="co">#&gt;     table &lt;- if (show_table) </span></span>
<span><span class="co">#&gt;         c(n_func, center_fun, interval_fun)</span></span>
<span><span class="co">#&gt;     else NULL</span></span>
<span><span class="co">#&gt;     ggtheme &lt;- ggplot2::theme_bw() + ggplot2::theme(legend.position = legend_pos) + </span></span>
<span><span class="co">#&gt;         ggplot2::theme(axis.title.x = ggplot2::element_blank())</span></span>
<span><span class="co">#&gt;     ggtheme &lt;- if (!show_v_grid) {</span></span>
<span><span class="co">#&gt;         ggtheme + ggplot2::theme(panel.grid.major.x = ggplot2::element_blank())</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     else {</span></span>
<span><span class="co">#&gt;         ggtheme + ggplot2::theme(panel.grid.major.x = ggplot2::element_line(linewidth = 1))</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     ggtheme &lt;- if (!show_h_grid) {</span></span>
<span><span class="co">#&gt;         ggtheme + ggplot2::theme(panel.grid.minor.y = ggplot2::element_blank(), </span></span>
<span><span class="co">#&gt;             panel.grid.major.y = ggplot2::element_blank())</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     else {</span></span>
<span><span class="co">#&gt;         ggtheme + ggplot2::theme(panel.grid.minor.y = ggplot2::element_line(linewidth = 1), </span></span>
<span><span class="co">#&gt;             panel.grid.major.y = ggplot2::element_line(linewidth = 1))</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     if (!is.null(names(line_col))) {</span></span>
<span><span class="co">#&gt;         color_lvl &lt;- sort(unique(df[[arm_var]]))</span></span>
<span><span class="co">#&gt;         col &lt;- line_col[as.character(color_lvl)]</span></span>
<span><span class="co">#&gt;         if (anyNA(col)) {</span></span>
<span><span class="co">#&gt;             missing_col &lt;- setdiff(color_lvl, names(col))</span></span>
<span><span class="co">#&gt;             stop(paste("Missing color matching for", toString(missing_col)))</span></span>
<span><span class="co">#&gt;         }</span></span>
<span><span class="co">#&gt;         col &lt;- unname(col)</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     else {</span></span>
<span><span class="co">#&gt;         col &lt;- line_col</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     ret &lt;- lapply(data_ls, tern::g_lineplot, alt_count = adam_db[["adsl"]], </span></span>
<span><span class="co">#&gt;         variables = variables, mid = center_fun, interval = interval_fun, </span></span>
<span><span class="co">#&gt;         whiskers = whiskers_fun, position = ggplot2::position_dodge(width = ifelse(jitter, </span></span>
<span><span class="co">#&gt;             0.3, 0)), title = title, table = table, ggtheme = ggtheme, </span></span>
<span><span class="co">#&gt;         col = col, subtitle_add_unit = !is.na(y_unit))</span></span>
<span><span class="co">#&gt;     do.call(gg_list, ret)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; post_fun &lt;- function (tlg, ...) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     tlg</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Create TLG.</span></span>
<span><span class="co">#&gt; tlg_output &lt;- rlang::exec(.fn = pre_fun, adam_db = syn_data, !!!args_list) |&gt;</span></span>
<span><span class="co">#&gt; rlang::exec(.fn = main_fun, !!!args_list) |&gt;</span></span>
<span><span class="co">#&gt; rlang::exec(.fn = post_fun, !!!args_list)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="nest">
  <p>chevron is a part of the <strong>NEST</strong> and <a href="https://pharmaverse.org/" class="external-link"><strong>pharmaverse</strong></a>.</p>
</div>
<script type="text/javascript" src="../analytics.js"></script></footer>
</div>

  

  

  </body>
</html>
