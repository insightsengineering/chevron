# run works as expected for chevron_t object

    Code
      res
    Output
        MedDRA System Organ Class                                                             
          MedDRA Preferred Term                      A: Drug X    B: Placebo    C: Combination
                                    Grade             (N=134)       (N=134)        (N=132)    
        ——————————————————————————————————————————————————————————————————————————————————————
        - Any adverse events -                                                                
                                    - Any Grade -   122 (91.0%)   123 (91.8%)    120 (90.9%)  
                                    Grade 1-2        13 (9.7%)    19 (14.2%)      11 (8.3%)   
                                    1                7 (5.2%)      9 (6.7%)        4 (3.0%)   
                                    2                6 (4.5%)      10 (7.5%)       7 (5.3%)   
                                    Grade 3-4       33 (24.6%)    34 (25.4%)      34 (25.8%)  
                                    3               18 (13.4%)    14 (10.4%)      16 (12.1%)  
                                    4               15 (11.2%)    20 (14.9%)      18 (13.6%)  
                                    Grade 5         76 (56.7%)    70 (52.2%)      75 (56.8%)  
        cl A.1                                                                                
          - Overall -                                                                         
                                    - Any Grade -   78 (58.2%)    75 (56.0%)      89 (67.4%)  
                                    Grade 1-2       78 (58.2%)    75 (56.0%)      89 (67.4%)  
                                    1               30 (22.4%)    27 (20.1%)      39 (29.5%)  
                                    2               48 (35.8%)    48 (35.8%)      50 (37.9%)  
          dcd A.1.1.1.1                                                                       
                                    - Any Grade -   50 (37.3%)    45 (33.6%)      63 (47.7%)  
                                    Grade 1-2       50 (37.3%)    45 (33.6%)      63 (47.7%)  
                                    1               50 (37.3%)    45 (33.6%)      63 (47.7%)  
          dcd A.1.1.1.2                                                                       
                                    - Any Grade -   48 (35.8%)    48 (35.8%)      50 (37.9%)  
                                    Grade 1-2       48 (35.8%)    48 (35.8%)      50 (37.9%)  
                                    2               48 (35.8%)    48 (35.8%)      50 (37.9%)  
        cl B.2                                                                                
          - Overall -                                                                         
                                    - Any Grade -   79 (59.0%)    74 (55.2%)      85 (64.4%)  
                                    Grade 1-2       30 (22.4%)    30 (22.4%)      33 (25.0%)  
                                    1               30 (22.4%)    30 (22.4%)      33 (25.0%)  
                                    Grade 3-4       49 (36.6%)    44 (32.8%)      52 (39.4%)  
                                    3               49 (36.6%)    44 (32.8%)      52 (39.4%)  
          dcd B.2.2.3.1                                                                       
                                    - Any Grade -   48 (35.8%)    54 (40.3%)      51 (38.6%)  
                                    Grade 1-2       48 (35.8%)    54 (40.3%)      51 (38.6%)  
                                    1               48 (35.8%)    54 (40.3%)      51 (38.6%)  
          dcd B.2.1.2.1                                                                       
                                    - Any Grade -   49 (36.6%)    44 (32.8%)      52 (39.4%)  
                                    Grade 3-4       49 (36.6%)    44 (32.8%)      52 (39.4%)  
                                    3               49 (36.6%)    44 (32.8%)      52 (39.4%)  
        cl D.1                                                                                
          - Overall -                                                                         
                                    - Any Grade -   79 (59.0%)    67 (50.0%)      80 (60.6%)  
                                    Grade 3-4       29 (21.6%)    25 (18.7%)      29 (22.0%)  
                                    3               29 (21.6%)    25 (18.7%)      29 (22.0%)  
                                    Grade 5         50 (37.3%)    42 (31.3%)      51 (38.6%)  
          dcd D.1.1.1.1                                                                       
                                    - Any Grade -   50 (37.3%)    42 (31.3%)      51 (38.6%)  
                                    Grade 5         50 (37.3%)    42 (31.3%)      51 (38.6%)  
          dcd D.1.1.4.2                                                                       
                                    - Any Grade -   48 (35.8%)    42 (31.3%)      50 (37.9%)  
                                    Grade 3-4       48 (35.8%)    42 (31.3%)      50 (37.9%)  
                                    3               48 (35.8%)    42 (31.3%)      50 (37.9%)  
        cl D.2                                                                                
          - Overall -                                                                         
                                    - Any Grade -   47 (35.1%)    58 (43.3%)      57 (43.2%)  
                                    Grade 1-2       47 (35.1%)    58 (43.3%)      57 (43.2%)  
                                    1               47 (35.1%)    58 (43.3%)      57 (43.2%)  
          dcd D.2.1.5.3                                                                       
                                    - Any Grade -   47 (35.1%)    58 (43.3%)      57 (43.2%)  
                                    Grade 1-2       47 (35.1%)    58 (43.3%)      57 (43.2%)  
                                    1               47 (35.1%)    58 (43.3%)      57 (43.2%)  
        cl B.1                                                                                
          - Overall -                                                                         
                                    - Any Grade -   47 (35.1%)    49 (36.6%)      43 (32.6%)  
                                    Grade 5         47 (35.1%)    49 (36.6%)      43 (32.6%)  
          dcd B.1.1.1.1                                                                       
                                    - Any Grade -   47 (35.1%)    49 (36.6%)      43 (32.6%)  
                                    Grade 5         47 (35.1%)    49 (36.6%)      43 (32.6%)  
        cl C.2                                                                                
          - Overall -                                                                         
                                    - Any Grade -   35 (26.1%)    48 (35.8%)      55 (41.7%)  
                                    Grade 1-2       35 (26.1%)    48 (35.8%)      55 (41.7%)  
                                    2               35 (26.1%)    48 (35.8%)      55 (41.7%)  
          dcd C.2.1.2.1                                                                       
                                    - Any Grade -   35 (26.1%)    48 (35.8%)      55 (41.7%)  
                                    Grade 1-2       35 (26.1%)    48 (35.8%)      55 (41.7%)  
                                    2               35 (26.1%)    48 (35.8%)      55 (41.7%)  
        cl C.1                                                                                
          - Overall -                                                                         
                                    - Any Grade -   43 (32.1%)    46 (34.3%)      43 (32.6%)  
                                    Grade 3-4       43 (32.1%)    46 (34.3%)      43 (32.6%)  
                                    4               43 (32.1%)    46 (34.3%)      43 (32.6%)  
          dcd C.1.1.1.3                                                                       
                                    - Any Grade -   43 (32.1%)    46 (34.3%)      43 (32.6%)  
                                    Grade 3-4       43 (32.1%)    46 (34.3%)      43 (32.6%)  
                                    4               43 (32.1%)    46 (34.3%)      43 (32.6%)  

# script_funs works as expected

    Code
      res
    Output
       [1] "# Edit Preprocessing Function."                                                           
       [2] "pre_fun <- function(adam_db, ...) {"                                                      
       [3] "  checkmate::assert_class(adam_db, \"dm\")"                                               
       [4] ""                                                                                         
       [5] "  new_format <- list("                                                                    
       [6] "    adae = list("                                                                         
       [7] "      AEBODSYS = rule(\"No Coding Available\" = c(\"\", NA, \"<Missing>\")),"             
       [8] "      AEDECOD = rule(\"No Coding Available\" = c(\"\", NA, \"<Missing>\")),"              
       [9] "      ATOXGR = rule(\"No Grading Available\" = c(\"\", NA, \"<Missing>\"))"               
      [10] "    )"                                                                                    
      [11] "  )"                                                                                      
      [12] ""                                                                                         
      [13] "  adam_db <- dunlin::reformat(adam_db, new_format, na_last = TRUE)"                       
      [14] ""                                                                                         
      [15] "  adam_db %>%"                                                                            
      [16] "    dm_zoom_to(\"adae\") %>%"                                                             
      [17] "    filter(.data$ANL01FL == \"Y\") %>%"                                                   
      [18] "    filter(.data$ATOXGR != \"No Grading Available\") %>%"                                 
      [19] "    mutate(ATOXGR = factor(.data$ATOXGR,"                                                 
      [20] "      levels = setdiff(levels(.data$ATOXGR), \"No Grading Available\")"                   
      [21] "    )) %>%"                                                                               
      [22] "    dm_update_zoomed()"                                                                   
      [23] "}"                                                                                        
      [24] ""                                                                                         
      [25] "# Create TLG."                                                                            
      [26] "rlang::exec(.fn = pre_fun, adam_db = data, !!!args_ls) |>"                                
      [27] "rlang::exec(.fn = run, object = aet04_1, !!!args_ls, auto_pre = FALSE, check_arg = FALSE)"

# script_funs works as expected with details set to TRUE

    Code
      res
    Output
       [1] "# Edit Functions."                                                                                          
       [2] "pre_fun <- function(adam_db, ...) {"                                                                        
       [3] "  checkmate::assert_class(adam_db, \"dm\")"                                                                 
       [4] ""                                                                                                           
       [5] "  new_format <- list("                                                                                      
       [6] "    adae = list("                                                                                           
       [7] "      AEBODSYS = rule(\"No Coding Available\" = c(\"\", NA, \"<Missing>\")),"                               
       [8] "      AEDECOD = rule(\"No Coding Available\" = c(\"\", NA, \"<Missing>\")),"                                
       [9] "      ATOXGR = rule(\"No Grading Available\" = c(\"\", NA, \"<Missing>\"))"                                 
      [10] "    )"                                                                                                      
      [11] "  )"                                                                                                        
      [12] ""                                                                                                           
      [13] "  adam_db <- dunlin::reformat(adam_db, new_format, na_last = TRUE)"                                         
      [14] ""                                                                                                           
      [15] "  adam_db %>%"                                                                                              
      [16] "    dm_zoom_to(\"adae\") %>%"                                                                               
      [17] "    filter(.data$ANL01FL == \"Y\") %>%"                                                                     
      [18] "    filter(.data$ATOXGR != \"No Grading Available\") %>%"                                                   
      [19] "    mutate(ATOXGR = factor(.data$ATOXGR,"                                                                   
      [20] "      levels = setdiff(levels(.data$ATOXGR), \"No Grading Available\")"                                     
      [21] "    )) %>%"                                                                                                 
      [22] "    dm_update_zoomed()"                                                                                     
      [23] "}"                                                                                                          
      [24] ""                                                                                                           
      [25] "main_fun <- function(adam_db,"                                                                              
      [26] "                         arm_var = \"ACTARM\","                                                             
      [27] "                         grade_groups = NULL,"                                                              
      [28] "                         lbl_overall = NULL,"                                                               
      [29] "                         deco = std_deco(\"AET04\"),"                                                       
      [30] "                         ...) {"                                                                            
      [31] "  dbsel <- get_db_data(adam_db, \"adsl\", \"adae\")"                                                        
      [32] "  assert_colnames(dbsel$adae, c(\"AEBODSYS\", \"AEDECOD\", \"ATOXGR\"))"                                    
      [33] ""                                                                                                           
      [34] "  if (is.null(grade_groups)) {"                                                                             
      [35] "    grade_groups <- list("                                                                                  
      [36] "      \"Grade 1-2\" = c(\"1\", \"2\"),"                                                                     
      [37] "      \"Grade 3-4\" = c(\"3\", \"4\"),"                                                                     
      [38] "      \"Grade 5\" = c(\"5\")"                                                                               
      [39] "    )"                                                                                                      
      [40] "  }"                                                                                                        
      [41] ""                                                                                                           
      [42] "  checkmate::assert_factor(dbsel$adae[[\"ATOXGR\"]], any.missing = FALSE)"                                  
      [43] "  toxicity_grade <- levels(dbsel$adae[[\"ATOXGR\"]])"                                                       
      [44] ""                                                                                                           
      [45] "  checkmate::assert_list(grade_groups, types = \"character\")"                                              
      [46] ""                                                                                                           
      [47] "  lyt <- aet04_1_lyt("                                                                                      
      [48] "    arm_var = arm_var,"                                                                                     
      [49] "    lbl_overall = lbl_overall,"                                                                             
      [50] "    toxicity_grade = toxicity_grade,"                                                                       
      [51] "    grade_groups = grade_groups,"                                                                           
      [52] "    deco = deco"                                                                                            
      [53] "  )"                                                                                                        
      [54] ""                                                                                                           
      [55] "  tbl <- build_table(lyt, df = dbsel$adae, alt_counts_df = dbsel$adsl)"                                     
      [56] ""                                                                                                           
      [57] "  tbl"                                                                                                      
      [58] "}"                                                                                                          
      [59] ""                                                                                                           
      [60] "post_fun <- function(tlg, prune_0 = TRUE, ...) {"                                                           
      [61] "  if (prune_0) tlg <- tlg %>% trim_rows()"                                                                  
      [62] ""                                                                                                           
      [63] "  tbl_empty <- all(lapply(row_paths(tlg), `[[`, 3) == \"ALL\")"                                             
      [64] "  if (tbl_empty) {"                                                                                         
      [65] "    tbl_sorted <- basic_table() %>% build_table(matrix(\"\"))"                                              
      [66] "  } else {"                                                                                                 
      [67] "    score_all_sum <- function(tt) {"                                                                        
      [68] "      cleaf <- collect_leaves(tt)[[1]]"                                                                     
      [69] "      if (NROW(cleaf) == 0) {"                                                                              
      [70] "        stop(\"score_all_sum score function used at subtable [\", obj_name(tt), \"] that has no content.\")"
      [71] "      }"                                                                                                    
      [72] "      sum(sapply(row_values(cleaf), function(cv) cv[1]))"                                                   
      [73] "    }"                                                                                                      
      [74] ""                                                                                                           
      [75] "    tbl_sorted <- tlg %>%"                                                                                  
      [76] "      sort_at_path("                                                                                        
      [77] "        path = c(\"AEBODSYS\"),"                                                                            
      [78] "        scorefun = score_all_sum,"                                                                          
      [79] "        decreasing = TRUE"                                                                                  
      [80] "      ) %>%"                                                                                                
      [81] "      sort_at_path("                                                                                        
      [82] "        path = c(\"AEBODSYS\", \"*\", \"AEDECOD\"),"                                                        
      [83] "        scorefun = score_all_sum,"                                                                          
      [84] "        decreasing = TRUE"                                                                                  
      [85] "      )"                                                                                                    
      [86] "  }"                                                                                                        
      [87] ""                                                                                                           
      [88] "  std_postprocess(tbl_sorted)"                                                                              
      [89] "}"                                                                                                          
      [90] ""                                                                                                           
      [91] "# Create TLG."                                                                                              
      [92] "rlang::exec(.fn = pre_fun, adam_db = data, !!!args_ls) |>"                                                  
      [93] "rlang::exec(.fn = main_fun, !!!args_ls) |>"                                                                 
      [94] "rlang::exec(.fn = post_fun, !!!args_ls)"                                                                    

